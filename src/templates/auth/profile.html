{% extends "auth/base.html" %}

{% block title %}Profile - Weight Tracker{% endblock %}

{% block header %}{{ user.username }}'s Profile{% endblock %}
{% block subtitle %}Manage your account and view your progress{% endblock %}

{% block content %}
<!-- User Statistics -->
<div class="user-stats">
    <h3>Your Statistics</h3>
    <div class="stat-item">
        <span class="stat-label">Total Entries:</span>
        <span class="stat-value">{{ stats.total_entries }}</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Categories:</span>
        <span class="stat-value">{{ stats.total_categories }}</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Latest Entry:</span>
        <span class="stat-value">{{ stats.latest_entry_date or 'No entries yet' }}</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Member Since:</span>
        <span class="stat-value">{{ stats.member_since }}</span>
    </div>
    {% if user.last_login %}
    <div class="stat-item">
        <span class="stat-label">Last Login:</span>
        <span class="stat-value">{{ user.last_login.strftime('%Y-%m-%d %H:%M') }}</span>
    </div>
    {% endif %}
</div>

<!-- Account Information -->
<div class="form-group" style="position: relative;">
    <label>Username</label>
    <div style="display: flex; align-items: center; gap: 10px;">
        <input type="text" value="{{ user.username }}" readonly class="form-control" style="background-color: #f8f9fa; flex: 1;">
        <a href="{{ url_for('auth.change_username') }}" style="color: #3498db; text-decoration: none; font-size: 14px; white-space: nowrap;">Change</a>
    </div>
</div>

<div class="form-group" style="position: relative;">
    <label>Email Address</label>
    <div style="display: flex; align-items: center; gap: 10px;">
        <input type="email" value="{{ user.email }}" readonly class="form-control" style="background-color: #f8f9fa; flex: 1;">
        <a href="{{ url_for('auth.change_email') }}" style="color: #3498db; text-decoration: none; font-size: 14px; white-space: nowrap;">Change</a>
    </div>
</div>

<!-- Account Actions -->
<div style="margin-top: 30px;">
    <a href="{{ url_for('auth.change_password') }}" class="btn" style="text-decoration: none; display: block; text-align: center; margin-bottom: 10px;">
        Change Password
    </a>
    
    <!-- Account Deletion (dangerous action) -->
    <button onclick="confirmDeleteAccount()" class="btn btn-danger" style="margin-top: 20px;">
        Delete Account
    </button>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%; text-align: center;">
        <h3 style="color: #e74c3c; margin-bottom: 15px;">⚠️ Delete Account</h3>
        <p style="margin-bottom: 20px; color: #333;">
            This action cannot be undone. All your data including weight entries and categories will be permanently deleted.
        </p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="closeDeleteModal()" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Cancel
            </button>
            <form method="POST" action="{{ url_for('auth.delete_account') }}" style="display: inline;">
                <button type="submit" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Delete Forever
                </button>
            </form>
        </div>
    </div>
</div>

<script>
function confirmDeleteAccount() {
    document.getElementById('deleteModal').style.display = 'flex';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Dark mode support for modal
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.querySelector('#deleteModal > div');
    const theme = document.documentElement.getAttribute('data-theme');
    
    if (theme === 'dark') {
        modal.style.background = '#2d2d2d';
        modal.style.color = '#e0e0e0';
        const p = modal.querySelector('p');
        if (p) p.style.color = '#e0e0e0';
    }
});
</script>
{% endblock %}